# Domain Name System (DNS)
## Система доменных имён (DNS)

Ранее мы узнали об IP-адресах, которые позволяют каждому устройству соединяться с другими устройствами. Но, как известно, людям удобнее работать с именами, чем с числами. 

Это подводит нас к **Системе доменных имён (DNS)** — иерархической и децентрализованной системе именования, используемой для преобразования понятных человеку доменных имён в IP-адреса.

## Как работает DNS
Процесс DNS-запроса (lookup) включает следующие восемь шагов:

1. Клиент вводит example.com в веб-браузере, запрос отправляется в интернет и принимается **DNS-резолвером** (рекурсивным DNS-сервером).
    
2. Резолвер рекурсивно запрашивает **корневой DNS-сервер** (root nameserver).
    
3. Корневой сервер отвечает резолверу, предоставляя адрес **сервера домена верхнего уровня (TLD)**.
    
4. Резолвер затем отправляет запрос TLD-серверу зоны **.com**.
    
5. TLD-сервер отвечает, возвращая IP-адрес **авторитативного сервера имён** для запрашиваемого домена — example.com.
    
6. Затем рекурсивный резолвер отправляет запрос авторитативному серверу имён домена.
    
7. **Авторитативный сервер имён** возвращает резолверу IP-адрес, соответствующий example.com.
    
8. DNS-резолвер отвечает веб-браузеру, предоставляя IP-адрес домена, который был запрошен изначально.

## Типы DNS-серверов

Теперь давайте рассмотрим четыре основные группы серверов, составляющих инфраструктуру DNS.

### DNS-резолвер (рекурсивный резолвер)

**DNS-резолвер** (также известный как рекурсивный DNS-резолвер) — это первая остановка в DNS-запросе. Рекурсивный резолвер выступает посредником между клиентом и DNS-серверами имён. Получив DNS-запрос от веб-клиента, рекурсивный резолвер либо отвечает кэшированными данными, либо отправляет запрос корневому серверу имён, затем — TLD-серверу, и наконец — авторитативному серверу имён. После получения ответа от авторитативного сервера, содержащего запрошенный IP-адрес, рекурсивный резолвер отправляет ответ клиенту.

### Корневой DNS-сервер (Root nameserver)

**Корневой сервер** принимает запрос от рекурсивного резолвера, содержащий доменное имя, и направляет резолвер к соответствующему TLD-серверу на основе расширения домена (.com, .net, .org и т.д.). Корневые серверы имён находятся под управлением некоммерческой организации **ICANN** (Интернет-корпорация по присвоению имён и номеров).

Существует **13 корневых DNS-серверов**, известных каждому рекурсивному резолверу. Важно понимать: 13 корневых серверов — это не 13 физических машин, а **13 типов** корневых серверов. По всему миру развёрнуто множество копий каждого типа, которые используют **Anycast-маршрутизацию** для обеспечения быстрого ответа.

### TLD-сервер (сервер доменов верхнего уровня)

**TLD-сервер** хранит информацию обо всех доменных именах, имеющих общее расширение — например, .com, .net или то, что идёт после последней точки в URL-адресе.

Управление TLD-серверами осуществляется организацией **IANA** (Администрация адресного пространства Интернет), которая является подразделением ICANN. IANA разделяет TLD-серверы на две основные группы:

- **Общие домены верхнего уровня (gTLD):** домены вроде .com, .org, .net, .edu и .gov.
    
- **Национальные домены верхнего уровня (ccTLD):** домены, привязанные к конкретной стране или территории. Примеры: .uk, .us, .ru и .jp.
    

### Авторитативный DNS-сервер (Authoritative nameserver)

**Авторитативный сервер имён** — это, как правило, последний шаг резолвера в поиске IP-адреса. Авторитативный сервер содержит информацию, специфичную для обслуживаемого им домена. Он может предоставить рекурсивному резолверу IP-адрес этого сервера, найденный в **A-записи** DNS. Если у домена есть **CNAME-запись** (псевдоним), сервер вернёт резолверу псевдоним, и тогда рекурсивному резолверу придётся выполнить новый полноценный DNS-запрос, чтобы получить запись от другого авторитативного сервера (чаще всего A-запись, содержащую IP-адрес). Если сервер не может найти домен, он возвращает сообщение **NXDOMAIN**.

## Типы DNS-запросов

В системе DNS существует три типа запросов:

### Рекурсивный запрос (Recursive Query)

При **рекурсивном запросе** DNS-клиент требует, чтобы DNS-сервер (обычно рекурсивный резолвер) ответил клиенту либо запрошенной ресурсной записью, либо сообщением об ошибке, если резолвер не может найти запись. Резолвер обязан выполнить все необходимые действия для получения ответа.

### Итеративный запрос (Iterative Query)

При **итеративном запросе** DNS-клиент предоставляет имя хоста, а DNS-резолвер возвращает наилучший ответ, который у него есть. Если у резолвера есть соответствующие DNS-записи в кэше, он возвращает их. Если нет — он перенаправляет DNS-клиента к корневому серверу или другому авторитативному серверу имён, ближайшему к требуемой DNS-зоне. Затем DNS-клиент должен повторить запрос уже напрямую к тому серверу, на который его перенаправили.

### Нерекурсивный запрос (Non-recursive Query)

**Нерекурсивный запрос** — это запрос, на который DNS-резолвер уже знает ответ. Он либо немедленно возвращает DNS-запись, потому что она уже сохранена в его локальном кэше, либо запрашивает авторитативный DNS-сервер, который точно хранит правильный IP-адрес для данного имени. В обоих случаях не требуется дополнительных раундов запросов (как в рекурсивных или итеративных). Ответ возвращается клиенту немедленно.

## Типы DNS-записей

**DNS-записи** (также известные как файлы зон) — это инструкции, которые хранятся на авторитативных DNS-серверах и содержат информацию о домене, включая то, какой IP-адрес связан с этим доменом и как обрабатывать запросы к нему.

Эти записи состоят из серии текстовых файлов, написанных в так называемом **DNS-синтаксисе**. DNS-синтаксис — это просто строка символов, используемая как команда, указывающая DNS-серверу, что делать. У всех DNS-записей также есть **TTL** (time-to-live — время жизни), которое указывает, как часто DNS-сервер должен обновлять эту запись.

Существует множество типов записей, но сейчас давайте рассмотрим наиболее часто используемые:


| Тип записи | Название на русском            | Описание                                                                                                            |
| ---------- | ------------------------------ | ------------------------------------------------------------------------------------------------------------------- |
| **A**      | Адресная запись                | Содержит IPv4-адрес домена.                                                                                         |
| **AAAA**   | Адресная запись IPv6           | Содержит IPv6-адрес домена (в отличие от A-записей, которые хранят IPv4-адрес).                                     |
| **CNAME**  | Каноническая запись имени      | Перенаправляет один домен или поддомен на другой домен, НЕ предоставляет IP-адрес.                                  |
| **MX**     | Запись почтового обменника     | Направляет почту на почтовый сервер.                                                                                |
| **TXT**    | Текстовая запись               | Позволяет администратору хранить текстовые заметки в записи. Часто используется для безопасности электронной почты. |
| **NS**     | Записи сервера имён            | Хранит сервер имён для DNS-записи.                                                                                  |
| **SOA**    | Запись о начале полномочий     | Хранит административную информацию о домене.                                                                        |
| **SRV**    | Запись о местоположении службы | Указывает порт для конкретных служб.                                                                                |
| **PTR**    | Указатель обратного запроса    | Предоставляет доменное имя при обратном просмотре.                                                                  |
| **CERT**   | Сертификатная запись           | Хранит сертификаты открытых ключей.                                                                                 |

## Поддомены (Subdomains)

**Поддомен** — это дополнительная часть основного доменного имени. Обычно используется для логического разделения веб-сайта на разделы. Мы можем создавать множество поддоменов (или дочерних доменов) на основном домене.

Например, `blog.example.com`, где `blog` — это поддомен, `example` — основной домен, а `.com` — домен верхнего уровня (TLD). Аналогичные примеры: `support.example.com` или `careers.example.com`.

---

## DNS-зоны (DNS Zones)

**DNS-зона** — это отдельная часть пространства доменных имён, которая делегируется юридическому лицу (человеку, организации или компании), ответственному за её обслуживание. DNS-зона также выполняет административную функцию, позволяя осуществлять гранулярное управление компонентами DNS, такими как авторитативные серверы имён.

---

## DNS-кэширование (DNS Caching)

**DNS-кэш** (иногда называемый кэшем DNS-резолвера) — это временная база данных, поддерживаемая операционной системой компьютера, которая содержит записи обо всех недавних посещениях и попытках посещения веб-сайтов и других интернет-доменов. Другими словами, DNS-кэш — это просто память о недавних DNS-запросах, к которой наш компьютер может быстро обратиться, когда пытается загрузить веб-сайт.

Система доменных имён использует параметр **TTL** (time-to-live — время жизни) для каждой DNS-записи. TTL указывает количество секунд, в течение которых запись может кэшироваться DNS-клиентом или сервером. Когда запись сохраняется в кэше, значение её TTL также сохраняется. Сервер непрерывно обновляет TTL записи, хранящейся в кэше, отсчитывая секунды вниз. Когда значение достигает нуля, запись удаляется (очищается) из кэша. В этот момент, если поступит запрос на эту запись, DNS-серверу придётся начать процесс разрешения заново.

---

## Обратный DNS (Reverse DNS / rDNS)

**Обратный DNS-запрос** — это DNS-запрос для получения доменного имени, связанного с заданным IP-адресом. Это противоположность более распространённому прямому DNS-запросу, при котором система DNS опрашивается для получения IP-адреса. Процесс обратного разрешения IP-адреса использует **PTR-записи**. Если у сервера нет PTR-записи, он не может выполнить обратный запрос.

Обратные запросы обычно используются почтовыми серверами. Почтовые серверы проверяют, пришло ли электронное письмо с действительного сервера, прежде чем пропустить его в свою сеть. Многие почтовые серверы будут отклонять сообщения от любых серверов, которые не поддерживают обратные запросы, или от серверов, которые с высокой вероятностью не являются легитимными.
